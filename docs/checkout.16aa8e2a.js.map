{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,S,aAGO,SAASC,EAAqBC,GACnCC,QAAQC,IAAI,oBAAqBF,GACjC,MAAMG,EAAMC,SAASC,cAAc,sBAC7BC,EAAiBF,SAASG,cAAc,MAC9CJ,EAAIK,OAAOF,GACXA,EAAeG,UAAYT,EAASU,KAEpC,MAAMC,EAAkBP,SAASG,cAAc,MAC/CJ,EAAIK,OAAOG,GACXA,EAAgBF,UAAYT,EAASY,MAAQ,IAC/C,EAEA,WACE,MAAMC,GAAY,EAAAhB,EAAAiB,gBAElB,IAAKD,EACH,OAEF,IAAIE,EAAa,EACjB,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAUI,OAAQD,IAAK,CACzC,IAAIE,EAAkBL,EAAUG,GAChCjB,EAAqBmB,GACrBH,GAAcI,SAASD,EAAgBN,MACzC,CAEA,MAAMQ,EAAehB,SAASG,cAAc,MAC5Ca,EAAaX,UAAY,gBAAgBM,OACzCX,SAASC,cAAc,sBAAsBgB,YAAYD,GAEzD,MAAME,EAAkBlB,SAASG,cAAc,UAC/Ce,EAAgBb,UAAY,aAC5Ba,EAAgBC,iBAAiB,SAAS,WACxCC,aAAaC,WAAW,aACxB,MAAMC,EAAoBtB,SAASC,cAAc,sBACjDqB,EAAkBC,UAAY,GAC9B,MAAMP,EAAehB,SAASG,cAAc,MAC5Ca,EAAaX,UAAY,oBACzBiB,EAAkBL,YAAYD,EAChC,IAEAhB,SAASC,cAAc,sBAAsBgB,YAAYC,EAC3D,CAEAM,GAEA,WACE,MAAMf,GAAY,EAAAhB,EAAAiB,gBAClB,IAAKD,EACH,OAEF,IAGIgB,EAHOhB,EAAUiB,KAAI,SAAU9B,GACjC,OAAOmB,SAASnB,EAASY,MAC3B,IACemB,QAAO,SAAUC,EAAMC,GACpC,OAAOD,EAAOC,CAChB,GAAG,GACHhC,QAAQC,IAAI2B,EACd,CACAK,GA2BAC,eAAeC,EAAoBC,GACjC,IACE,MAAMC,EAAY,IACbD,EACHE,MAAOF,EAAKE,OAGRC,EAAS,GAAGC,EAAAC,sBAAsBJ,EAAUK,UAC5CC,QAAiBC,MAAML,GAEvBM,SADoBF,EAASG,QACAR,MAE7BS,EAAgBF,EADP,EAEf7C,QAAQC,IAAI4C,GACZ7C,QAAQC,IAAI8C,GAERF,EAAiB,GACnBG,MAAM,wBAGR,IAAIC,EAAS,CACXC,OAAQ,QACRC,KAAMC,KAAKC,UAAU,CAAEf,MAAOS,IAC9BO,QAAS,CACP,eAAgB,2BAGdV,MAAML,EAAQU,EACtB,CAAE,MAAOM,GACPvD,QAAQC,IAAIsD,EACd,CACF,CAxDuBpD,SAASC,cAAc,iBAC/BkB,iBAAiB,SAEhCY,iBACE,MAAMsB,EAAiBjC,aAAakC,QAAQ,aAE5C,GAAID,EAAgB,CAClB,MAAM5C,EAAYwC,KAAKM,MAAMF,GAC7B,IAAK,IAAIzC,EAAI,EAAGA,EAAIH,EAAUI,OAAQD,IAAK,CACzC,MAAMqB,EAAOxB,EAAUG,GACvB,GAAIqB,EAAKE,OAAS,EAChBU,MAAM,oBACD,OACiBb,EAAoBC,EAC5C,CACF,CACF,CAEAuB,YAAW,KACTX,MAAM,0BACNzB,aAAaC,WAAW,aACxBoC,SAASC,KAAO,iBACf,IACL","sources":["src/modules/checkout.js"],"sourcesContent":["import { getCartItems } from \"./cart.js\";\r\nimport { baseUrl } from \"../firebase.js\";\r\n\r\nexport function renderSingleCartItem(cartItem) {\r\n  console.log(`renderOneCartItem`, cartItem);\r\n  const div = document.querySelector(\"#checkoutContainer\");\r\n  const nameForProduct = document.createElement(\"h1\");\r\n  div.append(nameForProduct);\r\n  nameForProduct.innerText = cartItem.name;\r\n\r\n  const priceForProduct = document.createElement(\"h3\");\r\n  div.append(priceForProduct);\r\n  priceForProduct.innerText = cartItem.price + \"kr\";\r\n}\r\n\r\nfunction renderCartItems() {\r\n  const cartItems = getCartItems();\r\n\r\n  if (!cartItems) {\r\n    return;\r\n  }\r\n  let totalPrice = 0;\r\n  for (let i = 0; i < cartItems.length; i++) {\r\n    let currentCartItem = cartItems[i];\r\n    renderSingleCartItem(currentCartItem);\r\n    totalPrice += parseInt(currentCartItem.price);\r\n  }\r\n\r\n  const totalElement = document.createElement(\"h3\");\r\n  totalElement.innerText = `Total Price: ${totalPrice} kr`;\r\n  document.querySelector(\"#checkoutContainer\").appendChild(totalElement);\r\n\r\n  const clearCartButton = document.createElement(\"button\");\r\n  clearCartButton.innerText = \"Clear Cart\";\r\n  clearCartButton.addEventListener(\"click\", function clearCart() {\r\n    localStorage.removeItem(\"cartItems\");\r\n    const checkoutContainer = document.querySelector(\"#checkoutContainer\");\r\n    checkoutContainer.innerHTML = \"\";\r\n    const totalElement = document.createElement(\"h3\");\r\n    totalElement.innerText = `Total Price: 0 kr`;\r\n    checkoutContainer.appendChild(totalElement);\r\n  });\r\n\r\n  document.querySelector(\"#checkoutContainer\").appendChild(clearCartButton);\r\n}\r\n\r\nrenderCartItems();\r\n\r\nfunction getTotal() {\r\n  const cartItems = getCartItems();\r\n  if (!cartItems) {\r\n    return;\r\n  }\r\n  let temp = cartItems.map(function (cartItem) {\r\n    return parseInt(cartItem.price);\r\n  });\r\n  let sum = temp.reduce(function (prev, next) {\r\n    return prev + next;\r\n  }, 0);\r\n  console.log(sum);\r\n}\r\ngetTotal();\r\n\r\nconst purchaseButton = document.querySelector(\"#purchase-btn\");\r\npurchaseButton.addEventListener(\"click\", onPurchaseButtonClicked);\r\n\r\nasync function onPurchaseButtonClicked() {\r\n  const cartItemString = localStorage.getItem(\"cartItems\");\r\n\r\n  if (cartItemString) {\r\n    const cartItems = JSON.parse(cartItemString);\r\n    for (let i = 0; i < cartItems.length; i++) {\r\n      const news = cartItems[i];\r\n      if (news.saldo <= 0) {\r\n        alert(\"out of stock\");\r\n      } else {\r\n        const newdata = await updatePurchaseItems(news);\r\n      }\r\n    }\r\n  }\r\n\r\n  setTimeout(() => {\r\n    alert(\"it has been purchased \");\r\n    localStorage.removeItem(\"cartItems\");\r\n    location.href = \"./index.html\";\r\n  }, 4000);\r\n}\r\n\r\nasync function updatePurchaseItems(news) {\r\n  try {\r\n    const firstItem = {\r\n      ...news,\r\n      saldo: news.saldo,\r\n    };\r\n\r\n    const newUrl = `${baseUrl}productinfo/${firstItem.id}.json`;\r\n    const response = await fetch(newUrl);\r\n    const dataInStock = await response.json();\r\n    const currentInStock = dataInStock.saldo;\r\n    const amount = 1;\r\n    const resultInStock = currentInStock - amount;\r\n    console.log(currentInStock);\r\n    console.log(resultInStock);\r\n\r\n    if (currentInStock < 0) {\r\n      alert(\"there is no products\");\r\n    }\r\n\r\n    let object = {\r\n      method: \"PATCH\",\r\n      body: JSON.stringify({ saldo: resultInStock }),\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    };\r\n    await fetch(newUrl, object);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n}\r\n"],"names":["$8qmuQ","parcelRequire","$9fa928f474a60c55$export$71d648179ee82dad","cartItem","console","log","div","document","querySelector","nameForProduct","createElement","append","innerText","name","priceForProduct","price","cartItems","getCartItems","totalPrice","i","length","currentCartItem","parseInt","totalElement","appendChild","clearCartButton","addEventListener","localStorage","removeItem","checkoutContainer","innerHTML","$9fa928f474a60c55$var$renderCartItems","sum","map","reduce","prev","next","$9fa928f474a60c55$var$getTotal","async","$9fa928f474a60c55$var$updatePurchaseItems","news","firstItem","saldo","newUrl","$1uU4k","baseUrl","id","response","fetch","currentInStock","json","resultInStock","alert","object","method","body","JSON","stringify","headers","error","cartItemString","getItem","parse","setTimeout","location","href"],"version":3,"file":"checkout.16aa8e2a.js.map"}